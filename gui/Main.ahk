Gui -MinimizeBox -MaximizeBox -Theme +OwnDialogs
Gui Add, GroupBox, x8 y8 w926 h276, 按键设置 - [ 红色为启用连发 蓝色为关闭连发 ]
Gui Font, s12 cBlue
Gui Add, Text, vEsc gMainKeyClick x16 y30 w36 h36 +0x200 +0x400000 +Center , Esc
Gui Add, Text, vF1 gMainKeyClick x90 y30 w36 h36 +0x200 +0x400000 +Center , F1
Gui Add, Text, vF2 gMainKeyClick x130 y30 w36 h36 +0x200 +0x400000 +Center , F2
Gui Add, Text, vF3 gMainKeyClick x170 y30 w36 h36 +0x200 +0x400000 +Center , F3
Gui Add, Text, vF4 gMainKeyClick x210 y30 w36 h36 +0x200 +0x400000 +Center , F4
Gui Add, Text, vF5 gMainKeyClick x270 y30 w36 h36 +0x200 +0x400000 +Center , F5
Gui Add, Text, vF6 gMainKeyClick x310 y30 w36 h36 +0x200 +0x400000 +Center , F6
Gui Add, Text, vF7 gMainKeyClick x350 y30 w36 h36 +0x200 +0x400000 +Center , F7
Gui Add, Text, vF8 gMainKeyClick x390 y30 w36 h36 +0x200 +0x400000 +Center , F8
Gui Add, Text, vF9 gMainKeyClick x450 y30 w36 h36 +0x200 +0x400000 +Center , F9
Gui Add, Text, vF10 gMainKeyClick x490 y30 w36 h36 +0x200 +0x400000 +Center , F10
Gui Add, Text, vF11 gMainKeyClick x530 y30 w36 h36 +0x200 +0x400000 +Center , F11
Gui Add, Text, vF12 gMainKeyClick x570 y30 w36 h36 +0x200 +0x400000 +Center , F12

Gui Add, Text, vTilde gMainKeyClick x16 y80 w36 h36 +0x200 +0x400000 +Center, ``
Gui Add, Text, v1 gMainKeyClick x56 y80 w36 h36 +0x200 +0x400000 +Center, 1
Gui Add, Text, v2 gMainKeyClick x96 y80 w36 h36 +0x200 +0x400000 +Center, 2
Gui Add, Text, v3 gMainKeyClick x136 y80 w36 h36 +0x200 +0x400000 +Center, 3
Gui Add, Text, v4 gMainKeyClick x176 y80 w36 h36 +0x200 +0x400000 +Center, 4
Gui Add, Text, v5 gMainKeyClick x216 y80 w36 h36 +0x200 +0x400000 +Center, 5
Gui Add, Text, v6 gMainKeyClick x256 y80 w36 h36 +0x200 +0x400000 +Center, 6
Gui Add, Text, v7 gMainKeyClick x296 y80 w36 h36 +0x200 +0x400000 +Center, 7
Gui Add, Text, v8 gMainKeyClick x336 y80 w36 h36 +0x200 +0x400000 +Center, 8
Gui Add, Text, v9 gMainKeyClick x376 y80 w36 h36 +0x200 +0x400000 +Center, 9
Gui Add, Text, v0 gMainKeyClick x416 y80 w36 h36 +0x200 +0x400000 +Center, 0
Gui Add, Text, vSub gMainKeyClick x456 y80 w36 h36 +0x200 +0x400000 +Center, -
Gui Add, Text, vAdd gMainKeyClick x496 y80 w36 h36 +0x200 +0x400000 +Center, +
Gui Add, Text, vBackspace gMainKeyClick x536 y80 w70 h36 +0x200 +0x400000 +Center, ←

Gui Add, Text, vTab gMainKeyClick x16 y120 w54 h36 +0x200 +0x400000 +Center, Tab
Gui Add, Text, vQ gMainKeyClick x74 y120 w36 h36 +0x200 +0x400000 +Center, Q
Gui Add, Text, vW gMainKeyClick x114 y120 w36 h36 +0x200 +0x400000 +Center, W
Gui Add, Text, vE gMainKeyClick x154 y120 w36 h36 +0x200 +0x400000 +Center, E
Gui Add, Text, vR gMainKeyClick x194 y120 w36 h36 +0x200 +0x400000 +Center, R
Gui Add, Text, vT gMainKeyClick x234 y120 w36 h36 +0x200 +0x400000 +Center, T
Gui Add, Text, vY gMainKeyClick x274 y120 w36 h36 +0x200 +0x400000 +Center, Y
Gui Add, Text, vU gMainKeyClick x314 y120 w36 h36 +0x200 +0x400000 +Center, U
Gui Add, Text, vI gMainKeyClick x354 y120 w36 h36 +0x200 +0x400000 +Center, I
Gui Add, Text, vO gMainKeyClick x394 y120 w36 h36 +0x200 +0x400000 +Center, O
Gui Add, Text, vP gMainKeyClick x434 y120 w36 h36 +0x200 +0x400000 +Center, P
Gui Add, Text, vLeftBracket gMainKeyClick x474 y120 w36 h36 +0x200 +0x400000 +Center, `[
Gui Add, Text, vRightBracket gMainKeyClick x514 y120 w36 h36 +0x200 +0x400000 +Center, `]
Gui Add, Text, vBackslash gMainKeyClick x554 y120 w52 h36 +0x200 +0x400000 +Center, `\

Gui Add, Text, vCaps gMainKeyClick x16 y160 w64 h36 +0x200 +0x400000 +Center, Caps
Gui Add, Text, vA gMainKeyClick x84 y160 w36 h36 +0x200 +0x400000 +Center, A
Gui Add, Text, vS gMainKeyClick x124 y160 w36 h36 +0x200 +0x400000 +Center, S
Gui Add, Text, vD gMainKeyClick x164 y160 w36 h36 +0x200 +0x400000 +Center, D
Gui Add, Text, vF gMainKeyClick x204 y160 w36 h36 +0x200 +0x400000 +Center, F
Gui Add, Text, vG gMainKeyClick x244 y160 w36 h36 +0x200 +0x400000 +Center, G
Gui Add, Text, vH gMainKeyClick x284 y160 w36 h36 +0x200 +0x400000 +Center, H
Gui Add, Text, vJ gMainKeyClick x324 y160 w36 h36 +0x200 +0x400000 +Center, J
Gui Add, Text, vK gMainKeyClick x364 y160 w36 h36 +0x200 +0x400000 +Center, K
Gui Add, Text, vL gMainKeyClick x404 y160 w36 h36 +0x200 +0x400000 +Center, L
Gui Add, Text, vSemicolon gMainKeyClick x444 y160 w36 h36 +0x200 +0x400000 +Center, `;
Gui Add, Text, vQuotationMark gMainKeyClick x484 y160 w36 h36 +0x200 +0x400000 +Center, `'
Gui Add, Text, vEnter gMainKeyClick x524 y160 w82 h36 +0x200 +0x400000 +Center, Enter

Gui Add, Text, vLShift gMainKeyClick x16 y200 w86 h36 +0x200 +0x400000 +Center, Shift
Gui Add, Text, vZ gMainKeyClick x106 y200 w36 h36 +0x200 +0x400000 +Center, Z
Gui Add, Text, vX gMainKeyClick x146 y200 w36 h36 +0x200 +0x400000 +Center, X
Gui Add, Text, vC gMainKeyClick x186 y200 w36 h36 +0x200 +0x400000 +Center, C
Gui Add, Text, vV gMainKeyClick x226 y200 w36 h36 +0x200 +0x400000 +Center, V
Gui Add, Text, vB gMainKeyClick x266 y200 w36 h36 +0x200 +0x400000 +Center, B
Gui Add, Text, vN gMainKeyClick x306 y200 w36 h36 +0x200 +0x400000 +Center, N
Gui Add, Text, vM gMainKeyClick x346 y200 w36 h36 +0x200 +0x400000 +Center, M
Gui Add, Text, vComma gMainKeyClick x386 y200 w36 h36 +0x200 +0x400000 +Center, `,
Gui Add, Text, vPeriod gMainKeyClick x426 y200 w36 h36 +0x200 +0x400000 +Center, `.
Gui Add, Text, vSlash gMainKeyClick x466 y200 w36 h36 +0x200 +0x400000 +Center, `/
Gui Add, Text, vRShift gMainKeyClick x506 y200 w100 h36 +0x200 +0x400000 +Center, Shift

Gui Add, Text, vLCtrl gMainKeyClick x16 y240 w48 h36 +0x200 +0x400000 +Center, Ctrl
Gui Add, Text, x68 y240 w48 h36 +0x200 +0x400000 +Center +Disabled, Win
Gui Add, Text, vLAlt gMainKeyClick x120 y240 w48 h36 +0x200 +0x400000 +Center, Alt
Gui Add, Text, vSpace gMainKeyClick x172 y240 w226 h36 +0x200 +0x400000 +Center, Space
Gui Add, Text, vRAlt gMainKeyClick x402 y240 w48 h36 +0x200 +0x400000 +Center, Alt
Gui Add, Text, x454 y240 w48 h36 +0x200 +0x400000 +Center +Disabled, Fn
Gui Add, Text, x506 y240 w48 h36 +0x200 +0x400000 +Center +Disabled, App
Gui Add, Text, vRCtrl gMainKeyClick x558 y240 w48 h36 +0x200 +0x400000 +Center, Ctrl

Gui Add, Text, vUp gMainKeyClick x670 y200 w36 h36 +0x200 +0x400000 +Center, ↑
Gui Add, Text, vLeft gMainKeyClick x630 y240 w36 h36 +0x200 +0x400000 +Center, ←
Gui Add, Text, vDown gMainKeyClick x670 y240 w36 h36 +0x200 +0x400000 +Center, ↓
Gui Add, Text, vRight gMainKeyClick x710 y240 w36 h36 +0x200 +0x400000 +Center, →
Gui Add, Text, vNum0 gMainKeyClick x770 y240 w76 h36 +0x200 +0x400000 +Center, Num0
Gui Add, Text, vNumPeriod gMainKeyClick x850 y240 w36 h36 +0x200 +0x400000 +Center, .
Gui Add, Text, vNumSlash gMainKeyClick x810 y80 w36 h36 +0x200 +0x400000 +Center, /
Gui Add, Text, vNumStar gMainKeyClick x850 y80 w36 h36 +0x200 +0x400000 +Center, *
Gui Add, Text, vNumSub gMainKeyClick x890 y80 w36 h36 +0x200 +0x400000 +Center, -
Gui Add, Text, vNumAdd gMainKeyClick x890 y120 w36 h76 +0x200 +0x400000 +Center, +

Gui Font
Gui Font, s9 cBlue
Gui Add, Text, vIns gMainKeyClick x630 y70 w36 h36 +0x200 +0x400000 +Center, Ins
Gui Add, Text, vHome gMainKeyClick x670 y70 w36 h36 +0x200 +0x400000 +Center, Home
Gui Add, Text, vPgUp gMainKeyClick x710 y70 w36 h36 +0x200 +0x400000 +Center, PgUp
Gui Add, Text, vDel gMainKeyClick x630 y110 w36 h36 +0x200 +0x400000 +Center, Del
Gui Add, Text, vEnd gMainKeyClick x670 y110 w36 h36 +0x200 +0x400000 +Center, End
Gui Add, Text, vPgDn gMainKeyClick x710 y110 w36 h36 +0x200 +0x400000 +Center, PgDn

Gui Add, Text, vNum1 gMainKeyClick x770 y200 w36 h36 +0x200 +0x400000 +Center, Num1
Gui Add, Text, vNum2 gMainKeyClick x810 y200 w36 h36 +0x200 +0x400000 +Center, Num2
Gui Add, Text, vNum3 gMainKeyClick x850 y200 w36 h36 +0x200 +0x400000 +Center, Num3
Gui Add, Text, vNum4 gMainKeyClick x770 y160 w36 h36 +0x200 +0x400000 +Center, Num4
Gui Add, Text, vNum5 gMainKeyClick x810 y160 w36 h36 +0x200 +0x400000 +Center, Num5
Gui Add, Text, vNum6 gMainKeyClick x850 y160 w36 h36 +0x200 +0x400000 +Center, Num6
Gui Add, Text, vNum7 gMainKeyClick x770 y120 w36 h36 +0x200 +0x400000 +Center, Num7
Gui Add, Text, vNum8 gMainKeyClick x810 y120 w36 h36 +0x200 +0x400000 +Center, Num8
Gui Add, Text, vNum9 gMainKeyClick x850 y120 w36 h36 +0x200 +0x400000 +Center, Num9
Gui Font

Gui Font, s7 cBlue
Gui Add, Text, vPrtSc gMainKeyClick x630 y30 w36 h36 +0x200 +0x400000 +Center, PrtSc
Gui Add, Text, vScrLk gMainKeyClick x670 y30 w36 h36 +0x200 +0x400000 +Center, ScrLk
Gui Add, Text, vPause gMainKeyClick x710 y30 w36 h36 +0x200 +0x400000 +Center, Pause
Gui Add, Text, vNumEnter gMainKeyClick x890 y200 w36 h76 +0x400000 +Center, `n`n`nNum`nEnter
Gui Add, Text, vNumLk gMainKeyClick x770 y80 w36 h36 +0x200 +0x400000 +Center, NumLk
Gui Font

Gui Font, s9
Gui Add, Button, gMainClear x890 y30 w36 h36 +0x200 +Center, 清空
Gui Font

Gui Add, GroupBox, x8 y300 w275 h200, 配置设置

Gui Add, ListBox, vPreset x16 y320 w120 h180
Gui Add, Edit, vPresetName x150 y350 w120 h22
Gui Add, Text, x150 y320 w120 h24 +0x200, 配置名称
Gui Add, Button, gMainLoadPreset x150 y380 w120 h30, 读取配置
Gui Add, Button, gMainSavePreset x150 y420 w120 h30, 保存配置
Gui Add, Button, gMainDeletePreset x150 y460 w120 h30, 删除配置

Gui Add, Button, gMainCheckUpdate x526 y294 w200 h200, 检查更新
Gui Add, Button, gMainStart x734 y294 w200 h200, 启动连发

ShowGuiMain(){
    Gui Show, w940 h510, DAF连发工具 - DNF AutoFire - v%__Version%
    MainLoadAllPreset()
}

HideGuiMain(){
    Gui Hide
}

DisableGuiMain(){
    Gui +Disabled
}

; 设置Gui内按钮的样式
MainSetKeyState(key, state){
    color := "cRed"
    size := "s12"
    weight := "Bold"
    if(!state)
    {
        weight := "Norm"
        color := "cBlue"
    }
    if(key == "PrtSc" || key == "ScrLk" || key == "Pause" || key == "NumEnter" || key == "NumLk")
    {
        size := "s7"
    }
    if(key == "Ins" || key == "Home" || key == "PgUp" || key == "Del" || key == "End" || key == "PgDn" || key == "Num1" || key == "Num2" || key == "Num3" || key == "Num4" || key == "Num5" || key == "Num6" || key == "Num7" || key == "Num8" || key == "Num9")
    {
        size := "s9"
    }
    Gui, Font,%size% %color% %weight%
    GuiControl, Font, %key%
}

; 主界面按钮点击事件，设置按键状态
MainKeyClick() {
    key := A_GuiControl
    ChangeKeyAutoFireState(key)
}

; 主界面启动按钮事件，启动连发
MainStart(){
    HideGuiMain()
    StartAutoFire()
}

; 主界面清空按钮事件，清空当前所有的按键状态
MainClear(){
    MainSetAllKeysGuiDisable()
}

; 主界面保存配置点击事件
MainSavePreset(){
    global PresetName
    global _AutoFireEnableKeys
    Gui, Submit, NoHide
    if(PresetName != "")
    {
        SavePresetKeys(PresetName, _AutoFireEnableKeys)
    } else {
        MsgBox 0x2010, , 请输入配置名称
    }
    _NowSelectPreset := PresetName
    SaveLastPreset(PresetName)
    MainLoadAllPreset()
}

; 主界面读取配置点击事件
MainLoadPreset(){
    global Preset
    global PresetName
    Gui, Submit, NoHide
    _NowSelectPreset := Preset
    GuiControl, , PresetName, %Preset%
    MainSetAllKeysGuiDisable()
    ConfigKeys := LoadPresetKeys(Preset)
    SetAllKeysAutoFire(ConfigKeys)
    MainSetAllKeysGuiEnable(ConfigKeys)
    SaveLastPreset(Preset)
    StopAutoFire()
}

; 主界面删除配置点击事件
MainDeletePreset(){
    global Preset
    global PresetName
    Gui, Submit, NoHide
    DeletePreset(Preset)
    MainLoadAllPreset()
    GuiControl, Choose, Preset, |1
}

; 主界面批量设置按键连发开启
MainSetAllKeysGuiEnable(keys){
    for _, key in keys
    {
        MainSetKeyState(key, true)
    }
}

; 主界面批量设置按键连发关闭
MainSetAllKeysGuiDisable(){
    global _AutoFireEnableKeys
    for _, key in _AutoFireEnableKeys
    {
        MainSetKeyState(key, false)
    }
    _AutoFireEnableKeys := []
}

; 主界面读取配置列表
MainLoadAllPreset(){
    global _NowSelectPreset
    global PresetName
    global Preset
    presetList := LoadAllPresetString()
    GuiControl, , Preset, |%presetList%
    GuiControl, , PresetName, %_NowSelectPreset%
    MainSetAllKeysGuiDisable()
    ConfigKeys := LoadPresetKeys(_NowSelectPreset)
    SetAllKeysAutoFire(ConfigKeys)
    MainSetAllKeysGuiEnable(ConfigKeys)
    SaveLastPreset(_NowSelectPreset)
    StopAutoFire()
    try {
        GuiControl, ChooseString, Preset, |%_NowSelectPreset%
    } catch {
        GuiControl, Choose, Preset, |1
    }
}

; 主界面点击检查更新
MainCheckUpdate(){
    GetUpdateInfo()
}