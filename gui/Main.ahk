Gui -MinimizeBox -MaximizeBox -Theme
Gui Add, GroupBox, x8 y8 w936 h276, 按键设置 - [ 红色为启用连发 蓝色为关闭连发 ]
Gui Font, s12 cBlue
Gui Add, Text, vEsc gMainKeyClick x16 y30 w36 h36 +0x200 +0x400000 +Center , Esc
Gui Add, Text, vF1 gMainKeyClick x100 y30 w36 h36 +0x200 +0x400000 +Center , F1
Gui Add, Text, vF2 gMainKeyClick x140 y30 w36 h36 +0x200 +0x400000 +Center , F2
Gui Add, Text, vF3 gMainKeyClick x180 y30 w36 h36 +0x200 +0x400000 +Center , F3
Gui Add, Text, vF4 gMainKeyClick x220 y30 w36 h36 +0x200 +0x400000 +Center , F4
Gui Add, Text, vF5 gMainKeyClick x280 y30 w36 h36 +0x200 +0x400000 +Center , F5
Gui Add, Text, vF6 gMainKeyClick x320 y30 w36 h36 +0x200 +0x400000 +Center , F6
Gui Add, Text, vF7 gMainKeyClick x360 y30 w36 h36 +0x200 +0x400000 +Center , F7
Gui Add, Text, vF8 gMainKeyClick x400 y30 w36 h36 +0x200 +0x400000 +Center , F8
Gui Add, Text, vF9 gMainKeyClick x460 y30 w36 h36 +0x200 +0x400000 +Center , F9
Gui Add, Text, vF10 gMainKeyClick x500 y30 w36 h36 +0x200 +0x400000 +Center , F10
Gui Add, Text, vF11 gMainKeyClick x540 y30 w36 h36 +0x200 +0x400000 +Center , F11
Gui Add, Text, vF12 gMainKeyClick x580 y30 w36 h36 +0x200 +0x400000 +Center , F12

Gui Add, Text, vTilde gMainKeyClick x16 y80 w36 h36 +0x200 +0x400000 +Center, ``
Gui Add, Text, v1 gMainKeyClick x60 y80 w36 h36 +0x200 +0x400000 +Center, 1
Gui Add, Text, v2 gMainKeyClick x104 y80 w36 h36 +0x200 +0x400000 +Center, 2
Gui Add, Text, v3 gMainKeyClick x148 y80 w36 h36 +0x200 +0x400000 +Center, 3
Gui Add, Text, v4 gMainKeyClick x192 y80 w36 h36 +0x200 +0x400000 +Center, 4
Gui Add, Text, v5 gMainKeyClick x236 y80 w36 h36 +0x200 +0x400000 +Center, 5
Gui Add, Text, v6 gMainKeyClick x280 y80 w36 h36 +0x200 +0x400000 +Center, 6
Gui Add, Text, v7 gMainKeyClick x324 y80 w36 h36 +0x200 +0x400000 +Center, 7
Gui Add, Text, v8 gMainKeyClick x368 y80 w36 h36 +0x200 +0x400000 +Center, 8
Gui Add, Text, v9 gMainKeyClick x412 y80 w36 h36 +0x200 +0x400000 +Center, 9
Gui Add, Text, vSub gMainKeyClick x456 y80 w36 h36 +0x200 +0x400000 +Center, -
Gui Add, Text, vAdd gMainKeyClick x500 y80 w36 h36 +0x200 +0x400000 +Center, +
Gui Add, Text, vBackspace gMainKeyClick x544 y80 w72 h36 +0x200 +0x400000 +Center, ←

Gui Add, Text, vTab gMainKeyClick x16 y120 w50 h36 +0x200 +0x400000 +Center, Tab
Gui Add, Text, vQ gMainKeyClick x73 y120 w36 h36 +0x200 +0x400000 +Center, Q
Gui Add, Text, vW gMainKeyClick x114 y120 w36 h36 +0x200 +0x400000 +Center, W
Gui Add, Text, vE gMainKeyClick x155 y120 w36 h36 +0x200 +0x400000 +Center, E
Gui Add, Text, vR gMainKeyClick x196 y120 w36 h36 +0x200 +0x400000 +Center, R
Gui Add, Text, vT gMainKeyClick x237 y120 w36 h36 +0x200 +0x400000 +Center, T
Gui Add, Text, vY gMainKeyClick x278 y120 w36 h36 +0x200 +0x400000 +Center, Y
Gui Add, Text, vU gMainKeyClick x319 y120 w36 h36 +0x200 +0x400000 +Center, U
Gui Add, Text, vI gMainKeyClick x360 y120 w36 h36 +0x200 +0x400000 +Center, I
Gui Add, Text, vO gMainKeyClick x401 y120 w36 h36 +0x200 +0x400000 +Center, O
Gui Add, Text, vP gMainKeyClick x442 y120 w36 h36 +0x200 +0x400000 +Center, P
Gui Add, Text, vLeftBracket gMainKeyClick x483 y120 w36 h36 +0x200 +0x400000 +Center, `[
Gui Add, Text, vRightBracket gMainKeyClick x524 y120 w36 h36 +0x200 +0x400000 +Center, `]
Gui Add, Text, vBackslash gMainKeyClick x565 y120 w51 h36 +0x200 +0x400000 +Center, `\

Gui Add, Text, vCaps gMainKeyClick x16 y160 w64 h36 +0x200 +0x400000 +Center, Caps
Gui Add, Text, vA gMainKeyClick x85 y160 w36 h36 +0x200 +0x400000 +Center, A
Gui Add, Text, vS gMainKeyClick x126 y160 w36 h36 +0x200 +0x400000 +Center, S
Gui Add, Text, vD gMainKeyClick x167 y160 w36 h36 +0x200 +0x400000 +Center, D
Gui Add, Text, vF gMainKeyClick x208 y160 w36 h36 +0x200 +0x400000 +Center, F
Gui Add, Text, vG gMainKeyClick x249 y160 w36 h36 +0x200 +0x400000 +Center, G
Gui Add, Text, vH gMainKeyClick x290 y160 w36 h36 +0x200 +0x400000 +Center, H
Gui Add, Text, vJ gMainKeyClick x331 y160 w36 h36 +0x200 +0x400000 +Center, J
Gui Add, Text, vK gMainKeyClick x372 y160 w36 h36 +0x200 +0x400000 +Center, K
Gui Add, Text, vL gMainKeyClick x413 y160 w36 h36 +0x200 +0x400000 +Center, L
Gui Add, Text, vSemicolon gMainKeyClick x454 y160 w36 h36 +0x200 +0x400000 +Center, `;
Gui Add, Text, vQuotationMark gMainKeyClick x495 y160 w36 h36 +0x200 +0x400000 +Center, `'
Gui Add, Text, vEnter gMainKeyClick x536 y160 w80 h36 +0x200 +0x400000 +Center, Enter

Gui Add, Text, vLShift gMainKeyClick x16 y200 w85 h36 +0x200 +0x400000 +Center, Shift
Gui Add, Text, vZ gMainKeyClick x106 y200 w36 h36 +0x200 +0x400000 +Center, Z
Gui Add, Text, vX gMainKeyClick x147 y200 w36 h36 +0x200 +0x400000 +Center, X
Gui Add, Text, vC gMainKeyClick x188 y200 w36 h36 +0x200 +0x400000 +Center, C
Gui Add, Text, vV gMainKeyClick x229 y200 w36 h36 +0x200 +0x400000 +Center, V
Gui Add, Text, vB gMainKeyClick x270 y200 w36 h36 +0x200 +0x400000 +Center, B
Gui Add, Text, vN gMainKeyClick x311 y200 w36 h36 +0x200 +0x400000 +Center, N
Gui Add, Text, vM gMainKeyClick x352 y200 w36 h36 +0x200 +0x400000 +Center, M
Gui Add, Text, vComma gMainKeyClick x393 y200 w36 h36 +0x200 +0x400000 +Center, `,
Gui Add, Text, vPeriod gMainKeyClick x434 y200 w36 h36 +0x200 +0x400000 +Center, `.
Gui Add, Text, vSlash gMainKeyClick x475 y200 w36 h36 +0x200 +0x400000 +Center, `/
Gui Add, Text, vRShift gMainKeyClick x516 y200 w100 h36 +0x200 +0x400000 +Center, Shift

Gui Add, Text, vLCtrl gMainKeyClick x16 y240 w48 h36 +0x200 +0x400000 +Center, Ctrl
Gui Add, Text, x70 y240 w48 h36 +0x200 +0x400000 +Center +Disabled, Win
Gui Add, Text, vLAlt gMainKeyClick x124 y240 w48 h36 +0x200 +0x400000 +Center, Alt
Gui Add, Text, vSpace gMainKeyClick x178 y240 w224 h36 +0x200 +0x400000 +Center, Space
Gui Add, Text, vRAlt gMainKeyClick x408 y240 w48 h36 +0x200 +0x400000 +Center, Alt
Gui Add, Text, x462 y240 w48 h36 +0x200 +0x400000 +Center +Disabled, Fn
Gui Add, Text, x516 y240 w48 h36 +0x200 +0x400000 +Center +Disabled, List
Gui Add, Text, vRCtrl gMainKeyClick x568 y240 w48 h36 +0x200 +0x400000 +Center, Ctrl
Gui Add, Text, vUp gMainKeyClick x680 y200 w36 h36 +0x200 +0x400000 +Center, ↑
Gui Add, Text, vLeft gMainKeyClick x640 y240 w36 h36 +0x200 +0x400000 +Center, ←
Gui Add, Text, vDown gMainKeyClick x680 y240 w36 h36 +0x200 +0x400000 +Center, ↓
Gui Add, Text, vRight gMainKeyClick x720 y240 w36 h36 +0x200 +0x400000 +Center, →
Gui Add, Text, vNum0 gMainKeyClick x780 y240 w76 h36 +0x200 +0x400000 +Center, Num0
Gui Add, Text, vNumPeriod gMainKeyClick x860 y240 w36 h36 +0x200 +0x400000 +Center, .
Gui Add, Text, vNumSlash gMainKeyClick x820 y80 w36 h36 +0x200 +0x400000 +Center, /
Gui Add, Text, vNumStar gMainKeyClick x860 y80 w36 h36 +0x200 +0x400000 +Center, *
Gui Add, Text, vNumSub gMainKeyClick x900 y80 w36 h36 +0x200 +0x400000 +Center, -
Gui Add, Text, vNumAdd gMainKeyClick x900 y120 w36 h75 +0x200 +0x400000 +Center, +

Gui Font
Gui Font, s9 cBlue
Gui Add, Text, vIns gMainKeyClick x640 y70 w36 h36 +0x200 +0x400000 +Center, Ins
Gui Add, Text, vHome gMainKeyClick x680 y70 w36 h36 +0x200 +0x400000 +Center, Home
Gui Add, Text, vPgUp gMainKeyClick x720 y70 w36 h36 +0x200 +0x400000 +Center, PgUp
Gui Add, Text, vDel gMainKeyClick x640 y110 w36 h36 +0x200 +0x400000 +Center, Del
Gui Add, Text, vEnd gMainKeyClick x680 y110 w36 h36 +0x200 +0x400000 +Center, End
Gui Add, Text, vPgDn gMainKeyClick x720 y110 w36 h36 +0x200 +0x400000 +Center, PgDn

Gui Add, Text, vNum1 gMainKeyClick x780 y200 w36 h36 +0x200 +0x400000 +Center, Num1
Gui Add, Text, vNum2 gMainKeyClick x820 y200 w36 h36 +0x200 +0x400000 +Center, Num2
Gui Add, Text, vNum3 gMainKeyClick x860 y200 w36 h36 +0x200 +0x400000 +Center, Num3
Gui Add, Text, vNum4 gMainKeyClick x780 y160 w36 h36 +0x200 +0x400000 +Center, Num4
Gui Add, Text, vNum5 gMainKeyClick x820 y160 w36 h36 +0x200 +0x400000 +Center, Num5
Gui Add, Text, vNum6 gMainKeyClick x860 y160 w36 h36 +0x200 +0x400000 +Center, Num6
Gui Add, Text, vNum7 gMainKeyClick x780 y120 w36 h36 +0x200 +0x400000 +Center, Num7
Gui Add, Text, vNum8 gMainKeyClick x820 y120 w36 h36 +0x200 +0x400000 +Center, Num8
Gui Add, Text, vNum9 gMainKeyClick x860 y120 w36 h36 +0x200 +0x400000 +Center, Num9
Gui Font

Gui Font, s7 cBlue
Gui Add, Text, vPrtSc gMainKeyClick x640 y30 w36 h36 +0x200 +0x400000 +Center, PrtSc
Gui Add, Text, vScrLk gMainKeyClick x680 y30 w36 h36 +0x200 +0x400000 +Center, ScrLk
Gui Add, Text, vPause gMainKeyClick x720 y30 w36 h36 +0x200 +0x400000 +Center, Pause
Gui Add, Text, vNumEnter gMainKeyClick x900 y200 w36 h75 +0x400000 +Center, `n`n`nNum`nEnter
Gui Add, Text, vNumLk gMainKeyClick x780 y80 w36 h36 +0x200 +0x400000 +Center, NumLk
Gui Font

Gui Font, s9
Gui Add, Button, gMainClear x900 y30 w36 h36 +0x200 +Center, 清空
Gui Font

Gui Add, GroupBox, x8 y300 w275 h200, 配置设置

Gui Add, ListBox, vPreset x16 y320 w120 h180
Gui Add, Text, x150 y320 w120 h24 +0x200, 配置名称
Gui Add, Button, gMainLoadPreset x150 y380 w120 h30, 读取配置
Gui Add, Button, gMainSavePreset x150 y420 w120 h30, 保存配置
Gui Add, Button, gMainDeletePreset x150 y460 w120 h30, 删除配置
Gui Add, Button, gMainStart x744 y294 w200 h200, 启动连发
Gui Add, Edit, vPresetName x150 y350 w120 h22

ShowGuiMain(){
    Gui Show, w950 h510, DAF连发工具 - DNF AutoFire - v%__Version%
    MainLoadAllPreset()
}

HideGuiMain(){
    Gui Hide
}

; 设置Gui内按钮的样式
MainSetKeyState(key, state){
    color := "cRed"
    size := "s12"
    weight := "Bold"
    if(!state)
    {
        weight := "Norm"
        color := "cBlue"
    }
    if(key == "PrtSc" || key == "ScrLk" || key == "Pause" || key == "NumEnter" || key == "NumLk")
    {
        size := "s7"
    }
    if(key == "Ins" || key == "Home" || key == "PgUp" || key == "Del" || key == "End" || key == "PgDn" || key == "Num1" || key == "Num2" || key == "Num3" || key == "Num4" || key == "Num5" || key == "Num6" || key == "Num7" || key == "Num8" || key == "Num9")
    {
        size := "s9"
    }
    Gui, Font,%size% %color% %weight%
    GuiControl, Font, %key%
}

; 主界面按钮点击事件，设置按键状态
MainKeyClick() {
    key := A_GuiControl
    ChangeKeyAutoFireState(key)
}

; 主界面启动按钮事件，启动连发
MainStart(){
    HideGuiMain()
    StartAutoFire()
}

; 主界面清空按钮事件，清空当前所有的按键状态
MainClear(){
    MainSetAllKeysGuiDisable()
}

; 主界面保存配置点击事件
MainSavePreset(){
    global PresetName
    global _AutoFireEnableKeys
    Gui, Submit, NoHide
    if(PresetName != "")
    {
        SavePresetKeys(PresetName, _AutoFireEnableKeys)
    } else {
        MsgBox 0x2010, , 请输入配置名称
    }
    _NowSelectPreset := PresetName
    SaveLastPreset(PresetName)
    MainLoadAllPreset()
}

; 主界面读取配置点击事件
MainLoadPreset(){
    global Preset
    global PresetName
    Gui, Submit, NoHide
    _NowSelectPreset := Preset
    GuiControl, , PresetName, %Preset%
    MainSetAllKeysGuiDisable()
    ConfigKeys := LoadPresetKeys(Preset)
    SetAllKeysAutoFire(ConfigKeys)
    MainSetAllKeysGuiEnable(ConfigKeys)
    SaveLastPreset(Preset)
    StopAutoFire()
}

; 主界面删除配置点击事件
MainDeletePreset(){
    global Preset
    global PresetName
    Gui, Submit, NoHide
    DeletePreset(Preset)
    MainLoadAllPreset()
    GuiControl, Choose, Preset, |1
}

; 主界面批量设置按键连发开启
MainSetAllKeysGuiEnable(keys){
    for _, key in keys
    {
        MainSetKeyState(key, true)
    }
}

; 主界面批量设置按键连发关闭
MainSetAllKeysGuiDisable(){
    global _AutoFireEnableKeys
    for _, key in _AutoFireEnableKeys
    {
        MainSetKeyState(key, false)
    }
    _AutoFireEnableKeys := []
}

; 主界面读取配置列表
MainLoadAllPreset(){
    global _NowSelectPreset
    global PresetName
    global Preset
    presetList := LoadAllPresetString()
    GuiControl, , Preset, |%presetList%
    GuiControl, , PresetName, %_NowSelectPreset%
    MainSetAllKeysGuiDisable()
    ConfigKeys := LoadPresetKeys(_NowSelectPreset)
    SetAllKeysAutoFire(ConfigKeys)
    MainSetAllKeysGuiEnable(ConfigKeys)
    SaveLastPreset(_NowSelectPreset)
    StopAutoFire()
    try {
        GuiControl, ChooseString, Preset, |%_NowSelectPreset%
    } catch {
        GuiControl, Choose, Preset, |1
    }
}